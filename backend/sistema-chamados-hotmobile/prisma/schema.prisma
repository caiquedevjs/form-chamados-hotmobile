generator client {
  provider      = "prisma-client-js"  // <--- CORREÃ‡ÃƒO 1: Nome correto
  binaryTargets = ["native", "windows"] // MantÃ©m para compatibilidade com Windows
  // CORREÃ‡ÃƒO 2: Removido o 'output' para usar o padrÃ£o do NestJS
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  
}


enum StatusChamado {
  NOVO
  EM_ATENDIMENTO
  FINALIZADO
}

enum TipoAutor {
  CLIENTE
  SUPORTE
}
enum Prioridade {
  BAIXA
  MEDIA
  ALTA
  CRITICA
}

model Chamado {
  id          Int      @id @default(autoincrement())
  nomeEmpresa String
  servico     String
  descricao   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  status      StatusChamado @default(NOVO)
  prioridade  Prioridade @default(BAIXA)
  responsavel    String?  // Nome de quem assumiu
  responsavelCor String?  // ðŸ‘‡ NOVA COLUNA (Para pintar a bolinha no card)
  mensagensNaoLidas Int @default(0)
  emails    Email[]
  telefones Telefone[]
  anexos    Anexo[]
  interacoes  Interacao[]
  @@map("chamados")
}

model Email {
  id        Int     @id @default(autoincrement())
  endereco  String
  chamadoId Int
  chamado   Chamado @relation(fields: [chamadoId], references: [id], onDelete: Cascade)

  @@map("emails")
}

model Telefone {
  id        Int     @id @default(autoincrement())
  numero    String
  chamadoId Int
  chamado   Chamado @relation(fields: [chamadoId], references: [id], onDelete: Cascade)

  @@map("telefones")
}

model Interacao {
  id        Int      @id @default(autoincrement())
  texto     String
  autor     TipoAutor
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  interno   Boolean  @default(false)
  chamadoId Int
  chamado   Chamado @relation(fields: [chamadoId], references: [id], onDelete: Cascade)

  // ðŸ‘‡ ADICIONE ISTO: Uma interaÃ§Ã£o pode ter anexos
  anexos    Anexo[] 

  @@map("interacoes")
}

model Anexo {
  id           Int      @id @default(autoincrement())
  nomeOriginal String
  nomeArquivo  String
  caminho      String
  mimetype     String
  tamanho      Int
  createdAt    DateTime @default(now())

  chamadoId    Int
  chamado      Chamado @relation(fields: [chamadoId], references: [id], onDelete: Cascade)

  // ðŸ‘‡ ADICIONE ISTO: Opcional, pois anexos da abertura do chamado nÃ£o tÃªm interaÃ§Ã£o
  interacaoId  Int?     
  interacao    Interacao? @relation(fields: [interacaoId], references: [id]) 

  @@map("anexos")
}

model Usuario {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  senha     String   // SerÃ¡ salva criptografada (hash)
  nome      String
  cor       String   @default("#1976d2")
  createdAt DateTime @default(now())

  @@map("usuarios")
}


model RespostaPronta {
  id        Int      @id @default(autoincrement())
  titulo    String   // Ex: "SaudaÃ§Ã£o", "Encerrar"
  texto     String   @db.Text // O conteÃºdo da mensagem
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("respostas_prontas")
}